<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="mainpagestyle.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
         rel = "stylesheet">
      <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
      <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
  <link rel="shortcut icon" type="image/jpg" href="Logo.png"/>
  <title>Here's your session...</title>

  <script>
    $(function() {
       $( "#queuelist" ).sortable();
    });
 </script>
</head>

<body>

    <!-- sidebar code -->
    <div id="sidebar" class="sidebar">
     <img src="White Logo.png" id="logosidebar">
     <span id="welcometext">Welcome, Amy</span>
     <h4>MENU</h4>
     <a href="#">Home</a>
     <a href="#">Recent</a>
     <a href="#">Library</a>
     <h4>SESSIONS</h4>
     <a href="#"><img src="join-session.png" id="joinicon">Join Session</a>
     <a href="#"><img src="start-session.png" id="starticon">Start Session</a>
     <button class="openbtn"><img src="sidebar-icon.png" id="sidebaricon"></button>   
   </div> 

  <script>
    $('.openbtn').click(function(){
      $('.sidebar').toggleClass('active');
    });
  </script> 

<div id="main">
  <!-- logo + name header -->
  <h1>
    <div id="header" name="header">
      <img src="White Logo.png" id="logo">
      aux
      <!-- profile dropdown menu section-->
  <div id="profiledropdown" name="profiledropdown">
    
    <button onclick="myFunction()" class="dropbtn"><img src="pfp-ex.jpg" id="pfp"><span id="username">amy</span></button>
    <div id="myDropdown" class="dropdown-content">
      <a href="#">Profile</a>
      <a href="#">Settings</a>
      <a href="#">Log Out</a>
    </div>

    <script>
      function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
      }
    
      window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
          var dropdowns = document.getElementsByClassName("dropdown-content");
          var i;
          for (i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('show')) {
              openDropdown.classList.remove('show');
            }
          }
        }
      }
      </script>
  </div>
    </div>
  </h1> 
</div>
</div>

  <!-- dj session section -->

  <div id="djsession" name="djsession">
    <h2 style="margin-left: 105px;">Here's your session:</h2>
    <img src="dj-pfp.jpg" id="djpfp">
    <h3 id="sessionname">Kanye's Session</h3>
  </div>
  <br />
  <div id="sessionbuttons" name="sessionbuttons">
    <button class="sessionbutton" type="button"><span id="buttontext">invite others</span></button>
    <button class="sessionbutton" type="button"><span id="buttontext">end session</span></button>
  </div>

  <!-- music/queue section -->

  <div id="queuebox" name="queuebox">
    <p id="queuesubtitle">now playing:</p>
    <br />
    <img src="album-cover.jpg" id="albumcover">
    <div id="currentsong">
      <span style="color: #ddd;">telepatía</span><br />Kali Uchis<br />Sin Miedo (del Amor y Otros Demonios)
    </div>
    <br />

    <div id="audiocontrols">
      <button class="shufflebutton" type="button"><img src="shuffle-icon.png" id="shuffleicon"></button>
      <button class="rewindbutton" type="button"><img src="rewind-icon.png" id="rewindicon"></button>
      <button class="skipbutton" type="button"><img src="skip-icon.png" id="skipicon"></button>
      <button class="replaybutton" type="button"><img src="replay-icon.png" id="replayicon"></button>
    </div>

    <div class="audio-player">
    
      <div class="player-controls-scrubber">
          <small class="start-time"></small>
        <div class="play-pause">play</div>
          <small class="end-time"></small>
      </div>
      <div id="seekObjContainer">
        <div id="timeline1">
            <div id="seekObj1" class="playhead" style="margin-left: 0px;"></div>
        </div>
      </div>
      <div class="audio-wrapper">
          <audio id="player2" preload="auto">
          <source src="telepatia.mp3" type="audio/mp3">
          </audio>
      </div>
  </div>

  <script>
    var player1,onplayhead,playerId,timeline,playhead,timelineWidth;
jQuery(window).on("load", function () {
    audioPlay();
    timeCal();
    ballSeek();

});

function audioPlay() {
    /*var player = document.getElementById("player2");*/
  var player = $("#player2")[0];
  //alert(player);
    player.play();
    initProgressBar();
    isPlaying = true;
}

function initProgressBar() {
  jQuery(".play-pause").empty().text("⏵");
    player1 = document.getElementById("player2");
    player1.addEventListener("timeupdate", timeCal);
    var playBtn = jQuery(".play-pause");
          playBtn.click(function() {
            if (player1.paused === false) {
                player1.pause();
                isPlaying = false;
              jQuery(".play-pause").empty().text("⏵");

            } else {
                player1.play();
                isPlaying = true;
              jQuery(".play-pause").empty().text("⏸");
            }
          });

}

function timeCal() {
    var width = jQuery("#timeline1").width();
    var length = player1.duration;
    var current_time = player1.currentTime;

    // calculate total length of value
    var totalLength = calculateTotalValue(length);
  //console.info(totalLength);
    

    // calculate current value time
    var currentTime = calculateCurrentValue(current_time);
    jQuery(".start-time").html(currentTime);
    jQuery(".end-time").html(totalLength);

    var progressbar = document.getElementById("seekObj1");
    progressbar.style.marginLeft = width * (player1.currentTime / player1.duration) + "px";

}

function calculateTotalValue(length) {
    var minutes = Math.floor(length / 60);
      var  seconds_int = length - minutes * 60;
  if(seconds_int < 10){
    //console.info("here");
    seconds_int = "0"+seconds_int;
    //console.info(seconds_int);
  }
      var seconds_str = seconds_int.toString();
       var  seconds = seconds_str.substr(0, 2);
        var time = minutes + ':' + seconds;
//console.info(seconds_int)
    return time;
}

function calculateCurrentValue(currentTime) {
    var current_hour = parseInt(currentTime / 3600) % 24,
        current_minute = parseInt(currentTime / 60) % 60,
        current_seconds_long = currentTime % 60,
        current_seconds = current_seconds_long.toFixed(),
        current_time = (current_minute < 10 ? "0" + current_minute : current_minute) + ":" + (current_seconds < 10 ? "0" + current_seconds : current_seconds);
    return current_time;
}

function ballSeek() {
     onplayhead = null;
     playerId = null;
     timeline = document.getElementById("timeline1");
     playhead = document.getElementById("seekObj1");
     timelineWidth = timeline.offsetWidth - playhead.offsetWidth;

    timeline.addEventListener("click", seek);
    playhead.addEventListener('mousedown', drag);
    window.addEventListener('mouseup', mouseUp);

}


function seek(event) {
    var player = document.getElementById("player2");
    player.currentTime = player.duration * clickPercent(event, timeline, timelineWidth);
}

function clickPercent(e, timeline, timelineWidth) {
    return (event.clientX - getPosition(timeline)) / timelineWidth;
}

function getPosition(el) {
    return el.getBoundingClientRect().left;
}

function drag(e) {
    player1.removeEventListener("timeupdate", timeCal);
    onplayhead = jQuery(this).attr("id");
    playerId = jQuery(this).parents("li").find("audio").attr("id");
    var player = document.getElementById(playerId);
    window.addEventListener('mousemove', dragFunc);
    player.removeEventListener('timeupdate', timeUpdate);
}


function dragFunc(e) {
    var player = document.getElementById(onplayhead);
    var newMargLeft = e.clientX - getPosition(timeline);

    if (newMargLeft >= 0 && newMargLeft <= timelineWidth) {
        playhead.style.marginLeft = newMargLeft + "px";
    }
    if (newMargLeft < 0) {
        playhead.style.marginLeft = "0px";
    }
    if (newMargLeft > timelineWidth) {
        playhead.style.marginLeft = timelineWidth + "px";
    }
}

function mouseUp(e) {
    if (onplayhead != null) {
        var player = document.getElementById(playerId);
        window.removeEventListener('mousemove', dragFunc);
        player.currentTime = player.duration * clickPercent(e, timeline, timelineWidth);
        player1.addEventListener("timeupdate", timeCal);
        player.addEventListener('timeupdate', timeUpdate);
    }
    onplayhead = null;
}

function timeUpdate() {
    var player2 = document.getElementById(onplayhead);
    var player = document.getElementById(playerId);
    var playPercent = timelineWidth * (player.currentTime / player.duration);
    player2.style.marginLeft = playPercent + "px";
    // If song is over
    if (player.currentTime == player.duration) {
        player.pause();
    }

}

  </script>    

    <!--- queue table -->
    <div id="currentqueue">
      <p id="queuesubtitle">current queue:</p>
      <div id="queuelistbox-dj">
      <ol id="queuelist">
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
        <li><img src="album-cover.jpg" id="qalbumcover"><span id="qsonginfo"><span class="songtitle">telepatía</span><br/>Kali Uchis</span></li>
    </div>
    </div>
  </div>

</body>

</html>